<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet con Materialize CSS: Panel Lateral</title>

    <!-- Materialize CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <!-- Font Awesome CSS (para los marcadores) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Prism.js CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css" />

    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-bg-color: rgba(22, 22, 40, 0.7);
            --border-color: rgba(0, 170, 255, 0.3);
        }
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue';
            background: linear-gradient(to bottom right, rgba(45, 55, 85, 0.7), var(--bg-color));
            color: #e0e0e0;
        }
        .main-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 1.5rem;
            gap: 1.5rem;
            box-sizing: border-box;
        }
        h1 {
            text-align: center;
            margin: 0 0 1rem 0;
            flex-shrink: 0;
            color: #fff;
            font-size: 2.5rem;
        }
        .content-wrapper {
            display: flex;
            flex: 1;
            gap: 1.5rem;
            min-height: 0;
        }
        .card.map-card, .card.code-card {
            background-color: var(--card-bg-color);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .map-card { flex: 1 1 55%; min-height: 300px; }
        .code-card { flex: 1 1 45%; }
        #map {
            width: 100%;
            height: 100%;
        }
        .code-container { overflow: auto; background-color: #272822; height: 100%;}
        pre[class*="language-"] { font-size: 0.9em; margin: 0; height: 100%; }
        div.code-toolbar .toolbar { opacity: 1; }

        /* Estilos para los iconos personalizados */
        .custom-marker { background-color: rgba(255, 255, 255, 0.8); border: 2px solid #007bff; border-radius: 50%; width: 30px !important; height: 30px !important; display: flex; justify-content: center; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .custom-marker i { color: #007bff; font-size: 16px; }
        .custom-marker.playa i { color: #00aaff; }
        .custom-marker.parque i { color: #28a745; }
        .custom-marker.faro i { color: #ffc107; }

        /* Estilos para el Sidenav Card */
        .sidenav .card .card-image .card-title { font-size: 1.5rem; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); }
        .attribution { font-size: 0.8rem; color: #9e9e9e; margin-top: 1rem; line-height: 1.4; }
    </style>
</head>
<body>

    <div class="main-container">
        <h1>Leaflet + Materialize: Panel Lateral Interactivo</h1>
        <p style="text-align: center; margin-top: -1rem; margin-bottom: 1rem;"><a href="images.zip" download="images.zip">Descargar imágenes de ejemplo</a></p>
        <div class="content-wrapper">
            <div class="card map-card">
                <div id="map"></div>
            </div>
            <div class="card code-card">
                <div class="code-container">
                    <pre data-copy="Copiar" data-copy-success="Copiado!"><code id="code-display" class="language-html"></code></pre>
                </div>
            </div>
        </div>
    </div>

    <!-- Estructura del Sidenav -->
    <ul id="slide-out" class="sidenav">
        <!-- El contenido se insertará aquí dinámicamente -->
    </ul>

    <!-- Botón Flotante (FAB) para abrir el Sidenav -->
    <div class="fixed-action-btn">
        <a href="#" data-target="slide-out" class="btn-floating btn-large red sidenav-trigger">
            <i class="large material-icons">info_outline</i>
        </a>
    </div>

    <!-- JS Libs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-clike.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>

    <!-- Script principal que carga el código del ejemplo -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- INICIALIZACIÓN DE MATERIALIZE ---
            const sidenav_elems = document.querySelectorAll('.sidenav');
            const sidenav_instances = M.Sidenav.init(sidenav_elems);
            const fab_elems = document.querySelectorAll('.fixed-action-btn');
            const fab_instances = M.FloatingActionButton.init(fab_elems);

            // --- INICIALIZACIÓN DE LEAFLET ---
            const map = L.map('map').setView([43.3336, -8.3174], 13);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
            }).addTo(map);

            // --- LÓGICA PRINCIPAL ---
            const sidenavInstance = sidenav_instances[0];
            const sidenavContentEl = document.getElementById('slide-out');

            // Data for the markers' side panel
            const pointData = {
                "Faro de Mera": { image: "images/faro-mera.jpg", author: "De Iago Casabiell González", sourceURL: "https://commons.wikimedia.org/w/index.php?curid=49123906", licenseText: "CC BY-SA 4.0", licenseURL: "https://creativecommons.org/licenses/by-sa/4.0" },
                "Parque de José Martí": { image: "images/parque-jose-marti.jpg", author: "Estevoaei", sourceURL: "https://commons.wikimedia.org/wiki/File:Parque_Jos%C3%A9_Mart%C3%AD_de_Perillo,_Oleiros_-_monumento_2.jpg", licenseText: "CC BY-SA 4.0", licenseURL: "https://creativecommons.org/licenses/by-sa/4.0" },
                "Playa de Santa Cristina": { image: "images/playa-santa-cristina.jpg", author: "Vanbasten 23", sourceURL: "https://commons.wikimedia.org/wiki/File:Beach_of_Santa_Cristina.jpg", licenseText: "CC BY-SA 3.0", licenseURL: "https://creativecommons.org/licenses/by-sa/3.0" },
                "Playa de Bastiagueiro": { image: "images/playa-bastiagueiro.jpg", author: "sporras", sourceURL: "https://commons.wikimedia.org/wiki/File:Praia_de_Bastiagueiro.jpg", licenseText: "CC BY-SA 2.0", licenseURL: "https://creativecommons.org/licenses/by-sa/2.0" }
            };

            function updateSidenav(properties) {
                const extraData = pointData[properties.name] || { image: 'https://via.placeholder.com/300x200.png?text=No+encontrada', author: 'Desconocido', licenseText: 'Sin licencia', sourceURL: '#', licenseURL: '#' };
                const cardHtml = '<li>' +
                    '<div class="card">' +
                        '<div class="card-image">' +
                            '<img src="' + extraData.image + '" alt="' + properties.name + '">' +
                            '<span class="card-title">' + properties.name + '</span>' +
                        '</div>' +
                        '<div class="card-content">' +
                            '<p><b>Tipo:</b> ' + properties.tipo + '</p>' +
                            '<div class="attribution">' +
                                'Foto: <a href="' + extraData.sourceURL + '" target="_blank" rel="noopener noreferrer">' + extraData.author + '</a>' +
                                '<br>' +
                                '<a href="' + extraData.licenseURL + '" target="_blank" rel="noopener noreferrer">' + extraData.licenseText + '</a>' +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                '</li>';
                sidenavContentEl.innerHTML = cardHtml;
            }

            const geojsonData = {
              "type": "FeatureCollection",
              "name": "oleiros_puntos",
              "features": [
                {
                  "type": "Feature",
                  "properties": {
                    "name": "Playa de Santa Cristina",
                    "tipo": "Playa"
                  },
                  "geometry": {
                    "type": "Point",
                    "coordinates": [-8.378631, 43.339596]
                  }
                },
                {
                  "type": "Feature",
                  "properties": {
                    "name": "Parque de José Martí",
                    "tipo": "Parque"
                  },
                  "geometry": {
                    "type": "Point",
                    "coordinates": [-8.378567, 43.336728]
                  }
                },
                {
                  "type": "Feature",
                  "properties": {
                    "name": "Faro de Mera",
                    "tipo": "Faro"
                  },
                  "geometry": {
                    "type": "Point",
                    "coordinates": [-8.354416, 43.383347]
                  }
                },
                {
                  "type": "Feature",
                  "properties": {
                    "name": "Playa de Bastiagueiro",
                    "tipo": "Playa"
                  },
                  "geometry": {
                    "type": "Point",
                    "coordinates": [-8.362489, 43.340981]
                  }
                }
              ]
            };

            const geoJsonLayer = L.geoJSON(geojsonData, {
                pointToLayer: function (feature, latlng) {
                    let iconClass;
                    let markerColorClass = '';
                    switch (feature.properties.tipo) {
                        case 'Playa': iconClass = 'fa-umbrella-beach'; markerColorClass = 'playa'; break;
                        case 'Parque': iconClass = 'fa-tree'; markerColorClass = 'parque'; break;
                        case 'Faro': iconClass = 'fa-lightbulb'; markerColorClass = 'faro'; break;
                        default: iconClass = 'fa-map-marker-alt'; break;
                    }
                    const customIcon = L.divIcon({ className: 'custom-marker ' + markerColorClass, html: '<i class="fa-solid ' + iconClass + '"></i>', iconSize: [30, 30] });
                    return L.marker(latlng, { icon: customIcon });
                },
                onEachFeature: function (feature, layer) {
                    layer.on('click', function () { updateSidenav(feature.properties); sidenavInstance.open(); });
                }
            }).addTo(map);

            if (geoJsonLayer.getBounds().isValid()) { map.fitBounds(geoJsonLayer.getBounds(), { padding: [50, 50] }); }

            const codeDisplay = document.getElementById('code-display');
            const codeExample = `&lt;!DOCTYPE html&gt;
&lt;html lang="es"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;Ejemplo de Leaflet con Materialize&lt;/title&gt;

    &lt;!-- Materialize CSS --&gt;
    &lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"&gt;
    &lt;!-- Material Icons --&gt;
    &lt;link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"&gt;
    &lt;!-- Leaflet CSS --&gt;
    &lt;link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" /&gt;
    &lt;!-- Font Awesome CSS --&gt;
    &lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"&gt;

    &lt;style&gt;
        body, html { height: 100%; margin: 0; padding: 0; }
        #map { width: 100%; height: 100vh; }
        .custom-marker { background-color: rgba(255, 255, 255, 0.8); border: 2px solid #007bff; border-radius: 50%; width: 30px !important; height: 30px !important; display: flex; justify-content: center; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .custom-marker i { color: #007bff; font-size: 16px; }
        .custom-marker.playa i { color: #00aaff; }
        .custom-marker.parque i { color: #28a745; }
        .custom-marker.faro i { color: #ffc107; }
        .sidenav .card .card-image .card-title { font-size: 1.5rem; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); }
        .attribution { font-size: 0.8rem; color: #9e9e9e; margin-top: 1rem; line-height: 1.4; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

    &lt;div id="map"&gt;&lt;/div&gt;

    &lt;!-- Sidenav Structure --&gt;
    &lt;ul id="slide-out" class="sidenav"&gt;
        &lt;!-- Dynamic content will be injected here --&gt;
    &lt;/ul&gt;

    &lt;!-- Floating Action Button --&gt;
    &lt;div class="fixed-action-btn"&gt;
        &lt;a href="#" data-target="slide-out" class="btn-floating btn-large red sidenav-trigger"&gt;
            &lt;i class="large material-icons"&gt;info_outline&lt;/i&gt;
        &lt;/a&gt;
    &lt;/div&gt;

    &lt;!-- JavaScript Libraries --&gt;
    &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"&gt;&lt;/script&gt;
    &lt;script src="https://unpkg.com/leaflet/dist/leaflet.js"&gt;&lt;/script&gt;

    &lt;script&gt;
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Materialize components
            const sidenav_elems = document.querySelectorAll('.sidenav');
            const sidenav_instances = M.Sidenav.init(sidenav_elems);
            const fab_elems = document.querySelectorAll('.fixed-action-btn');
            const fab_instances = M.FloatingActionButton.init(fab_elems);

            // Initialize Leaflet map
            const map = L.map('map').setView([43.3336, -8.3174], 13);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                attribution: '&amp;copy; &lt;a href="https.openstreetmap.org/copyright"&gt;OpenStreetMap&lt;/a&gt; contributors &amp;copy; &lt;a href="https://carto.com/attributions"&gt;CARTO&lt;/a&gt;'
            }).addTo(map);

            // Main logic
            const sidenavInstance = sidenav_instances[0];
            const sidenavContentEl = document.getElementById('slide-out');

            // Data for the markers' side panel
            const pointData = {
                "Faro de Mera": { image: "images/faro-mera.jpg", author: "De Iago Casabiell González", sourceURL: "https://commons.wikimedia.org/w/index.php?curid=49123906", licenseText: "CC BY-SA 4.0", licenseURL: "https://creativecommons.org/licenses/by-sa/4.0" },
                "Parque de José Martí": { image: "images/parque-jose-marti.jpg", author: "Estevoaei", sourceURL: "https://commons.wikimedia.org/wiki/File:Parque_Jos%C3%A9_Mart%C3%AD_de_Perillo,_Oleiros_-_monumento_2.jpg", licenseText: "CC BY-SA 4.0", licenseURL: "https://creativecommons.org/licenses/by-sa/4.0" },
                "Playa de Santa Cristina": { image: "images/playa-santa-cristina.jpg", author: "Vanbasten 23", sourceURL: "https://commons.wikimedia.org/wiki/File:Beach_of_Santa_Cristina.jpg", licenseText: "CC BY-SA 3.0", licenseURL: "https://creativecommons.org/licenses/by-sa/3.0" },
                "Playa de Bastiagueiro": { image: "images/playa-bastiagueiro.jpg", author: "sporras", sourceURL: "https://commons.wikimedia.org/wiki/File:Praia_de_Bastiagueiro.jpg", licenseText: "CC BY-SA 2.0", licenseURL: "https://creativecommons.org/licenses/by-sa/2.0" }
            };

            // Function to update the side navigation panel
            function updateSidenav(properties) {
                const extraData = pointData[properties.name] || { image: 'https://via.placeholder.com/300x200.png?text=No+encontrada', author: 'Desconocido', licenseText: 'Sin licencia', sourceURL: '#', licenseURL: '#' };
                const cardHtml = '&lt;li&gt;' +
                    '&lt;div class=&quot;card&quot;&gt;' +
                        '&lt;div class=&quot;card-image&quot;&gt;' +
                            '&lt;img src=&quot;' + extraData.image + '&quot; alt=&quot;' + properties.name + '&quot;&gt;' +
                            '&lt;span class=&quot;card-title&quot;&gt;' + properties.name + '&lt;/span&gt;' +
                        '&lt;/div&gt;' +
                        '&lt;div class=&quot;card-content&quot;&gt;' +
                            '&lt;p&gt;&lt;b&gt;Tipo:&lt;/b&gt; ' + properties.tipo + '&lt;/p&gt;' +
                            '&lt;div class=&quot;attribution&quot;&gt;' +
                                'Foto: &lt;a href=&quot;' + extraData.sourceURL + '&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;' + extraData.author + '&lt;/a&gt;' +
                                '&lt;br&gt;' +
                                '&lt;a href=&quot;' + extraData.licenseURL + '&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;' + extraData.licenseText + '&lt;/a&gt;' +
                            '&lt;/div&gt;' +
                        '&lt;/div&gt;' +
                    '&lt;/div&gt;' +
                '&lt;/li&gt;';
                sidenavContentEl.innerHTML = cardHtml;
            }

            const geojsonData = {
              "type": "FeatureCollection",
              "name": "oleiros_puntos",
              "features": [
                {
                  "type": "Feature",
                  "properties": {
                    "name": "Playa de Santa Cristina",
                    "tipo": "Playa"
                  },
                  "geometry": {
                    "type": "Point",
                    "coordinates": [-8.378631, 43.339596]
                  }
                },
                {
                  "type": "Feature",
                  "properties": {
                    "name": "Parque de José Martí",
                    "tipo": "Parque"
                  },
                  "geometry": {
                    "type": "Point",
                    "coordinates": [-8.378567, 43.336728]
                  }
                },
                {
                  "type": "Feature",
                  "properties": {
                    "name": "Faro de Mera",
                    "tipo": "Faro"
                  },
                  "geometry": {
                    "type": "Point",
                    "coordinates": [-8.354416, 43.383347]
                  }
                },
                {
                  "type": "Feature",
                  "properties": {
                    "name": "Playa de Bastiagueiro",
                    "tipo": "Playa"
                  },
                  "geometry": {
                    "type": "Point",
                    "coordinates": [-8.362489, 43.340981]
                  }
                }
              ]
            };

            const geoJsonLayer = L.geoJSON(geojsonData, {
                pointToLayer: function (feature, latlng) {
                    let iconClass;
                    let markerColorClass = '';
                    switch (feature.properties.tipo) {
                        case 'Playa': iconClass = 'fa-umbrella-beach'; markerColorClass = 'playa'; break;
                        case 'Parque': iconClass = 'fa-tree'; markerColorClass = 'parque'; break;
                        case 'Faro': iconClass = 'fa-lightbulb'; markerColorClass = 'faro'; break;
                        default: iconClass = 'fa-map-marker-alt'; break;
                    }
                    const customIcon = L.divIcon({ className: 'custom-marker ' + markerColorClass, 
                    html: '&lt;i class=&quot;fa-solid ' + iconClass + '&quot;&gt;&lt;/i&gt;', iconSize: [30, 30] });
                    return L.marker(latlng, { icon: customIcon });
                },
                onEachFeature: function (feature, layer) {
                    layer.on('click', function () {
                        updateSidenav(feature.properties);
                        sidenavInstance.open();
                    });
                }
            }).addTo(map);

            if (geoJsonLayer.getBounds().isValid()) {
                map.fitBounds(geoJsonLayer.getBounds(), { padding: [50, 50] });
            }
        });
    &lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;`;
            codeDisplay.innerHTML = codeExample;
            Prism.highlightAll();
        });
    </script>

</body>
</html>